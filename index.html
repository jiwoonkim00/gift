<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‚¬ë‘ ì¬íŒì†Œ: ê¹…ì§€ìš´ vs ì„¸ë¡±ì´</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --card:#121a2b;
      --text:#e8eefc;
      --muted:#9bb0d6;
      --accent:#7c5cff;
      --good:#5dffb1;
      --bad:#ff5d7a;
      --line:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background:
        radial-gradient(900px 600px at 30% 10%, rgba(124,92,255,.28), transparent),
        radial-gradient(900px 600px at 80% 40%, rgba(93,255,177,.12), transparent),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px; margin:0 auto; padding:24px 16px 80px}
    .top{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:16px;
      background:rgba(18,26,43,.55); backdrop-filter: blur(10px);
      position:sticky; top:10px; z-index:5;
    }
    .badge{display:flex; gap:8px; align-items:center; color:var(--muted); font-size:13px}
    .dot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 20px rgba(124,92,255,.8)}
    .progress{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; font-size:12px; color:var(--muted)}
    .chip{padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:rgba(15,23,38,.65)}
    h1{font-size:28px; margin:26px 0 6px}
    p.lead{margin:0 0 18px; color:var(--muted)}
    .card{
      border:1px solid var(--line); border-radius:20px; background:rgba(18,26,43,.6);
      backdrop-filter: blur(8px); padding:18px;
    }
    .grid{display:grid; gap:14px}
    @media(min-width:820px){ .grid.two{grid-template-columns:1.1fr .9fr} }
    .title{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .title h2{margin:0; font-size:18px}
    .small{font-size:13px; color:var(--muted); line-height:1.55}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    button{
      border:1px solid var(--line); background:rgba(15,23,38,.75); color:var(--text);
      padding:10px 12px; border-radius:14px; cursor:pointer;
      transition:.15s transform ease, .15s border-color ease;
      font-weight:750;
    }
    button:hover{transform: translateY(-1px); border-color:rgba(124,92,255,.45)}
    button.primary{background:linear-gradient(135deg, rgba(124,92,255,.9), rgba(124,92,255,.55)); border-color:transparent}
    button.good{background:linear-gradient(135deg, rgba(93,255,177,.9), rgba(93,255,177,.35)); border-color:transparent; color:#062015}
    button.bad{background:linear-gradient(135deg, rgba(255,93,122,.9), rgba(255,93,122,.35)); border-color:transparent}
    .lock{opacity:.45}
    .sep{height:1px; background:var(--line); margin:16px 0}
    .hidden{display:none !important}

    /* Museum */
    .museum{display:grid; gap:12px; grid-template-columns:repeat(2, 1fr)}
    @media(min-width:620px){ .museum{grid-template-columns:repeat(3, 1fr)} }
    .item{
      padding:14px; border-radius:18px; border:1px solid var(--line);
      background:rgba(15,23,38,.7);
      cursor:pointer; transition:.15s transform ease, .15s border-color ease;
      min-height:96px; display:flex; flex-direction:column; justify-content:space-between;
    }
    .item:hover{transform: translateY(-1px); border-color:rgba(124,92,255,.45)}
    .tag{font-size:12px; color:var(--muted)}
    .seen{border-color:rgba(93,255,177,.45); box-shadow: inset 0 0 0 1px rgba(93,255,177,.2)}

    /* Modal */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.62);
      display:none; align-items:center; justify-content:center; padding:16px; z-index:10;
    }
    .modal.open{display:flex}
    .modalBox{
      width:min(720px, 100%); border-radius:22px; border:1px solid var(--line);
      background:rgba(18,26,43,.92); backdrop-filter: blur(10px);
      padding:18px;
    }
    .modalHead{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .close{background:transparent; border:1px solid var(--line); border-radius:12px; padding:8px 10px}
    .quote{
      margin:12px 0 0; padding:12px 14px; border-radius:16px;
      background:rgba(124,92,255,.12); border:1px solid rgba(124,92,255,.22);
      line-height:1.65;
    }

    /* Gauge */
    .barWrap{margin-top:10px}
    .bar{
      height:14px; border-radius:999px; background:rgba(255,255,255,.08);
      overflow:hidden; border:1px solid var(--line);
    }
    .bar > div{
      height:100%; width:0%;
      background:linear-gradient(90deg, rgba(255,93,122,.9), rgba(124,92,255,.9), rgba(93,255,177,.9));
      transition: .25s width ease;
    }
    .gInfo{display:flex; justify-content:space-between; gap:10px; margin-top:8px; color:var(--muted); font-size:12px}
    .toast{margin-top:10px; font-size:13px; color:var(--muted)}
    .shake{animation: shake .28s linear}
    @keyframes shake{
      0%{transform:translateX(0)} 25%{transform:translateX(-6px)}
      50%{transform:translateX(6px)} 75%{transform:translateX(-4px)}
      100%{transform:translateX(0)}
    }

    /* Safe */
    input{
      width:100%; padding:12px 12px; border-radius:14px;
      border:1px solid var(--line); background:rgba(15,23,38,.75); color:var(--text);
      font-size:15px;
    }
    .result{
      margin-top:12px; padding:14px; border-radius:16px;
      border:1px dashed rgba(93,255,177,.45);
      background:rgba(93,255,177,.08);
    }
    .footer{margin-top:26px; color:var(--muted); font-size:12px; text-align:center}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="badge"><span class="dot"></span> ì‚¬ë‘ ì¬íŒì†Œ Â· ì‚¬ê±´ë²ˆí˜¸ <b>#SE-RONG-0506</b></div>
      <div class="progress">
        <span class="chip" id="stepChip">STEP 1/4</span>
        <span class="chip" id="unlockChip">í•´ê¸ˆ: 0/3</span>
        <span class="chip">ë§Œë‚œ ë‚ : <b>2025-05-06</b></span>
      </div>
    </div>

    <h1>ğŸ‘©â€âš–ï¸ ì‚¬ë‘ ì¬íŒì†Œ</h1>
    <p class="lead">ì¬íŒ â†’ ì¦ê±° ë°•ë¬¼ê´€ â†’ ê¸°ë¶„ ê²Œì´ì§€(ë¯¸ì…˜) â†’ ê¸ˆê³ </p>

    <!-- STEP 1 -->
    <section class="card" id="step1">
      <div class="title">
        <h2>STEP 1) ì¬íŒ ì‹œì‘: í”¼ê³ ëŠ”â€¦ <span class="mono">ê¹…ì§€ìš´</span></h2>
        <div class="small" id="courtStatus">í˜ì˜: â€œì„¸ë¡±ì„ ë„ˆë¬´ ì¢‹ì•„í•´ì„œ ì¼ìƒìƒí™œì— ì§€ì¥ì´ ìˆë‹¤â€</div>
      </div>
      <div class="sep"></div>

      <div class="grid two">
        <div>
          <div class="small">
            ì¡´ê²½í•˜ëŠ” ì¬íŒì¥ë‹˜(=ì„¸ë¡±)â€¦<br/>
            í”¼ê³ (ê¹…ì§€ìš´)ëŠ” <b>ì‚¬ë‘ ê³¼ë‹¤</b> í˜ì˜ë¡œ ê¸°ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.<br/>
            ì•„ë˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ë³€ë¡ í•˜ì„¸ìš”.
          </div>
          <div class="btns">
            <button id="btnExcuse">ë³€ëª…í•œë‹¤ ğŸ¤“</button>
            <button id="btnAdmit">ì¸ì •í•œë‹¤ ğŸ™‹â€â™‚ï¸</button>
            <button id="btnAegyo" class="primary">ì• êµ ë¶€ë¦°ë‹¤ ğŸ¥º</button>
          </div>
        </div>
        <div class="card" style="background:rgba(15,23,38,.55)">
          <div class="small" style="margin-bottom:8px"><b>íŒê²°ë¬¸</b></div>
          <div id="verdict" style="line-height:1.7">
            â€œí”¼ê³ ëŠ” ì•„ì§ ë³€ë¡ ì„ ì‹œì‘í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.â€<br/>
            â€» ì¬íŒì¥ë‹˜ í´ë¦­ í•œ ë²ˆì´ë©´ í‰ìƒí˜•ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="btns" style="justify-content:flex-end">
        <button id="toMuseum" class="good">ì¦ê±° ë°•ë¬¼ê´€ìœ¼ë¡œ ì´ë™ âœ</button>
      </div>
    </section>

    <div style="height:14px"></div>

    <!-- STEP 2 -->
    <section class="card hidden" id="step2">
      <div class="title">
        <h2>STEP 2) ì¦ê±° ë°•ë¬¼ê´€: â€œê¹…ì§€ìš´ì´ ì„¸ë¡±ì„ ì¢‹ì•„í•œ í”ì ë“¤â€</h2>
        <div class="small">ì „ì‹œí’ˆ <b>3ê°œ ì´ìƒ</b> ê´€ëŒí•˜ë©´ ë‹¤ìŒ ë‹¨ê³„ê°€ í•´ê¸ˆë¼ìš”.</div>
      </div>
      <div class="sep"></div>

      <div class="museum" id="museumGrid"></div>

      <div class="sep"></div>
      <div class="small">ê´€ëŒ ì§„í–‰ë„: <b id="seenCount">0</b> / 5</div>
      <div class="btns" style="justify-content:flex-end">
        <button id="toGauge" class="good lock">ê¸°ë¶„ ê²Œì´ì§€ ê²Œì„(ì ê¹€)</button>
      </div>
    </section>

    <div style="height:14px"></div>

    <!-- STEP 3 -->
    <section class="card hidden" id="step3">
      <div class="title">
        <h2>STEP 3) ê¸°ë¶„ ê²Œì´ì§€: â€œì„¸ë¡± í–‰ë³µë„ 100% ë§Œë“¤ê¸°â€</h2>
        <div class="small" id="hintBox">íŒíŠ¸: í–‰ë™ì„ ì˜ ê³ ë¥´ë©´ ê²Œì´ì§€ê°€ ì˜¬ë¼ê°€ìš”.</div>
      </div>
      <div class="sep"></div>

      <div class="barWrap">
        <div class="bar"><div id="barFill"></div></div>
        <div class="gInfo">
          <span>í˜„ì¬: <b id="gVal">0%</b></span>
          <span>ëª©í‘œ: <b>100%</b></span>
        </div>
        <div class="toast" id="toast">ë¯¸ì…˜ì„ ì„ íƒí•´ë´!</div>
      </div>

      <div class="btns" style="margin-top:14px">
        <button class="good" data-delta="18">â€œì˜ˆì˜êµ¬ ì‚¬ë‘í•œë‹¤â€ 3ì—°íƒ€ ğŸ’¬ (+18)</button>
        <button class="good" data-delta="22">ë§›ìˆëŠ”ê±° ë¨¹ì´ê¸° â˜• (+22)</button>
        <button class="good" data-delta="26">ë¨¼ì € ì‚¬ê³¼í•˜ê¸° ğŸ™‡â€â™‚ï¸ (+26)</button>
        <button class="bad" data-delta="-15">ê¸ˆì§€ì–´: â€œê·¸ë ‡ê³ ë§Œâ€ ğŸ˜‡ (-15)</button>
        <button class="bad" data-delta="-20">ì½ì”¹í•˜ê¸°(ê³ ì˜) ğŸ¢ (-20)</button>
      </div>

      <div class="sep"></div>
      <div class="small" id="safeHint" style="display:none">
        âœ… ê¸ˆê³  íŒíŠ¸ê°€ í•´ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤!<br/>
        ë¹„ë°€ì½”ë“œ ê·œì¹™: <b>ë§Œë‚œ ë‚ ì—ì„œ ë‚˜ì˜¨ 4ìë¦¬</b>ë¥¼ ì…ë ¥í•˜ë©´ ì—´ë¦½ë‹ˆë‹¤.<br/>
        íŒíŠ¸: <b>2025ë…„ 5ì›” 6ì¼</b> â†’ (ìˆ«ì 4ìë¦¬)
      </div>

      <div class="btns" style="justify-content:flex-end">
        <button id="toSafe" class="good lock">ê¸ˆê³ ë¡œ ì´ë™(ì ê¹€)</button>
      </div>
    </section>

    <div style="height:14px"></div>

    <!-- STEP 4 -->
    <section class="card hidden" id="step4">
      <div class="title">
        <h2>STEP 4) ë¹„ë°€ ê¸ˆê³ : â€œì—´ë¦¬ë©´ ì—”ë”© ê³µê°œâ€</h2>
        <div class="small">ì½”ë“œ 3ë²ˆ í‹€ë¦¬ë©´â€¦ ì• êµ ì¸ì¦ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤(ë†ë‹´)</div>
      </div>
      <div class="sep"></div>

      <div class="grid two">
        <div>
          <div class="small">ë¹„ë°€ì½”ë“œë¥¼ ì…ë ¥í•´ì¤˜.</div>
          <input id="codeInput" placeholder="ì˜ˆ: 0506" inputmode="numeric" />
          <div class="btns">
            <button id="tryCode" class="primary">ê¸ˆê³  ì—´ê¸° ğŸ”</button>
            <button id="giveHint">íŒíŠ¸ ë³´ê¸° ğŸ’¡</button>
          </div>
          <div class="small" id="tries" style="margin-top:8px">ì‹œë„: 0 / 3</div>
        </div>
        <div class="card" style="background:rgba(15,23,38,.55)">
          <div class="small"><b>ê¸ˆê³  ìƒíƒœ</b></div>
          <div id="safeStatus" style="margin-top:8px; line-height:1.7; color:var(--muted)">
            â€œì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì½”ë“œê°€ ì…ë ¥ë˜ë©´â€¦â€
          </div>
        </div>
      </div>

      <div id="finalBox" class="result hidden">
        <div style="font-weight:900; font-size:16px">ğŸ‰ ê¸ˆê³ ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤!</div>
        <div style="margin-top:8px; line-height:1.7">
          <b>To. ì„¸ë¡±</b><br/>
          ê¹…ì§€ìš´ì€ ì„¸ë¡±ì„ ì¢‹ì•„í•©ë‹ˆë‹¤. (ì¦ê±°: ì´ í˜ì´ì§€ ì „ì²´)<br/>
          ì•ìœ¼ë¡œë„ ìš°ë¦¬ ë” í–‰ë³µí•˜ê²Œ ì§€ë‚´ì¥ ì‚¬ë‘í•´.<br/><br/>

          âœ… <b>ì„ ë¬¼</b>:
          <img src="gift.jpg" alt="ì„ ë¬¼" style="max-width:100%; border-radius:14px; margin-top:10px;">
        </div>
      </div>

      <div class="footer">
        ìˆ˜ì • í¬ì¸íŠ¸: <span class="mono">SAFE_CODE</span>, <span class="mono">EXHIBITS</span>, ì—”ë”©ì˜ ì„ ë¬¼ ì˜ì—­ë§Œ ë°”ê¾¸ë©´ ì™„ì„±!
      </div>
    </section>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modalBox">
      <div class="modalHead">
        <div>
          <div style="font-weight:900" id="mTitle">ì „ì‹œí’ˆ</div>
          <div class="tag" id="mTag">íƒœê·¸</div>
        </div>
        <button class="close" id="mClose">ë‹«ê¸° âœ•</button>
      </div>
      <div class="quote" id="mBody"></div>
    </div>
  </div>

  <script>
    const SAFE_CODE = "0506";

    // âœ… el ì „ì‹œí’ˆ ì œê±°: ì´ 5ê°œ
    const EXHIBITS = [
      { id:1, title:"ì „ì‹œí’ˆ #1: ê·€ì—¬ì›Œ ì£½ì„ ë»”í•œ ë‚ ", tag:"#2025_0316 #ìˆ ì°Œ", img:"alcol.jpg", body:"ì• ê¸°ê°€ ì™„ì „ ì·¨í•´ì„œ ì •ì‹  ìƒì€" },
      { id:2, title:"ì „ì‹œí’ˆ #2: ì‚¬ë‘ìŠ¤ëŸ¬ì›Œì„œ ì£½ì„ ë»”í•œ ë‚ ", tag:"#ì¡¸ê·€ #ê°œì´ì¨", img:"love.jpg", body:"ì € ë•Œ ì‹¬ì¥ ë¶€ì—¬ì¡ê³  ì“°ëŸ¬ì§ˆë»”í•œê±° ê°„ì‹ íˆ ì°¸ìŒ" },
      { id:3, title:"ì „ì‹œí’ˆ #3: ì‹ ì„¸ê²½ì´ë‘ ì¹´í˜ ê°„ë‚ ", tag:"#ì‹¬ì¥ê³¼ë¶€í•˜", img:"cafe.jpg", body:"ë…¹ì°¨ê°€ ì½”ë¡œ ë“¤ì–´ê°€ëŠ”ì§€ ì…ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ì§€ë„ ëª¨ë¥´ê³  ë§ˆì‹¬" },
      { id:4, title:"ì „ì‹œí’ˆ #4: ì„¸ë¡±ì´í•œí…Œë§Œ ê·€ì—¬ì›€", tag:"#ë¶€ì¸ë¶ˆê°€", img:"cute.jpg", body:"ì„¸ë¡±ì´í•œí…Œë§Œ ê·€ì—¬ì›€" },
      { id:5, title:"ì „ì‹œí’ˆ #5: ë¨¹ì„ê±° ëºê¸¸ê¹Œë´ ê²½ê³„í•˜ëŠ” ëª¨ìŠµë„ ê·€ì—¬ì›€", tag:"#í–„ë¶€ê¸° #ê¸°ì—¬ì›€", img:"food.jpg", body:"ê¹…ì§€ìš´í•œí…ŒëŠ” ì„¸ë¡±ì´ê°€ ì˜ë¨¹ëŠ”ê±°ë³´ë©´ ê¸°ë¶„ì´ ì¢‹ìŒ" },
      { id:6, title:"ì „ì‹œí’ˆ #6: ìš°ë¦¬ê°€ ê¼­ í•´ì•¼í• ê±°", tag:"#ì½”ë¼ë¦¬", img:"el.jpg", body:"ì½”ë¼ë¦¬ ë³´ëŸ¬ê°€ê¹… ã…ã… " },
    ];

    const stepChip = document.getElementById("stepChip");
    const unlockChip = document.getElementById("unlockChip");

    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");
    const step4 = document.getElementById("step4");

    const verdict = document.getElementById("verdict");
    const courtStatus = document.getElementById("courtStatus");

    const toMuseum = document.getElementById("toMuseum");
    const toGauge = document.getElementById("toGauge");
    const toSafe = document.getElementById("toSafe");

    const museumGrid = document.getElementById("museumGrid");
    const seenCountEl = document.getElementById("seenCount");

    const modal = document.getElementById("modal");
    const mTitle = document.getElementById("mTitle");
    const mTag = document.getElementById("mTag");
    const mBody = document.getElementById("mBody");

    const barFill = document.getElementById("barFill");
    const gVal = document.getElementById("gVal");
    const toast = document.getElementById("toast");
    const safeHint = document.getElementById("safeHint");

    const codeInput = document.getElementById("codeInput");
    const tryCode = document.getElementById("tryCode");
    const giveHint = document.getElementById("giveHint");
    const triesEl = document.getElementById("tries");
    const safeStatus = document.getElementById("safeStatus");
    const finalBox = document.getElementById("finalBox");

    let unlocked = 0;
    let seen = new Set();
    let gauge = 0;
    let tries = 0;

    function setStep(n){
      stepChip.textContent = `STEP ${n}/4`;
      const el = [null, document.getElementById("step1"), step2, step3, step4][n];
      el?.scrollIntoView({behavior:"smooth", block:"start"});
    }
    function setUnlock(){
      unlockChip.textContent = `í•´ê¸ˆ: ${unlocked}/3`;
    }

    // STEP 1
    document.getElementById("btnExcuse").addEventListener("click", ()=>{
      verdict.innerHTML =
        "ğŸ§¾ <b>ë³€ë¡ </b>: â€œì €ëŠ” ì›ë˜ ì´ëŸ° ì‚¬ëŒì´ ì•„ë‹ˆì—ˆëŠ”ë°â€¦ ì„¸ë¡±ì´ ë•Œë¬¸ì— ì´ë ‡ê²Œ ëìŠµë‹ˆë‹¤.â€<br/>" +
        "ğŸ‘©â€âš–ï¸ <b>íŒê²°</b>: ìœ ì£„(ì‚¬ë‘) + ê°í˜• ë¶ˆê°€(ê·€ì—¬ì›€).";
      courtStatus.textContent = "í˜ì˜ ì¶”ê°€: â€œì„¸ë¡± ì•ì—ì„œë§Œ ë§íˆ¬ê°€ ë‹¬ë¼ì§(ìƒìŠµ)â€";
    });
    document.getElementById("btnAdmit").addEventListener("click", ()=>{
      verdict.innerHTML =
        "ğŸ§¾ <b>ìë°±</b>: â€œë„¤. ê¹…ì§€ìš´ì€ ì„¸ë¡±ì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ì¦ê±°ëŠ”â€¦ ë„˜ì¹©ë‹ˆë‹¤.â€<br/>" +
        "ğŸ‘©â€âš–ï¸ <b>íŒê²°</b>: ìœ ì£„(ì‚¬ë‘) + í‰ìƒí˜•(ë™ì˜ í•„ìš”).";
      courtStatus.textContent = "í”¼ê³  íƒœë„ ì–‘í˜¸: â€œì•ìœ¼ë¡œë„ ë” ì˜í•˜ê² ìŠµë‹ˆë‹¤â€";
    });
    document.getElementById("btnAegyo").addEventListener("click", ()=>{
      verdict.innerHTML =
        "ğŸ§¾ <b>ì• êµ</b>: â€œì¬íŒì¥ë‹˜(ì„¸ë¡±)â€¦ ì €â€¦ ë³´ê³ ì‹¶ì—ˆì–´ìš”ğŸ¥ºâ€<br/>" +
        "ğŸ‘©â€âš–ï¸ <b>íŒê²°</b>: ì¦‰ê²°ì‹¬íŒ â†’ <b>ë½€ë½€ 100íšŒ</b>ë¡œ ì¢…ê²°.";
      courtStatus.textContent = "ì¬íŒì¥ í”ë“¤ë¦¼ ê°ì§€: â€œì›ƒìŒ ì°¸ê¸° ì‹¤íŒ¨â€";
    });

    toMuseum.addEventListener("click", ()=>{
      step2.classList.remove("hidden");
      setStep(2);
      unlocked = Math.max(unlocked, 1);
      setUnlock();
    });

    // STEP 2
    function renderMuseum(){
      museumGrid.innerHTML = "";
      EXHIBITS.forEach(ex=>{
        const div = document.createElement("div");
        div.className = "item" + (seen.has(ex.id) ? " seen" : "");
        div.innerHTML = `
          <div style="font-weight:900">${ex.title}</div>
          <div class="tag">${ex.tag}</div>
        `;

        div.addEventListener("click", ()=>{
          mTitle.textContent = ex.title;
          mTag.textContent = ex.tag;

          // âœ… ì‚¬ì§„ + í…ìŠ¤íŠ¸ í•¨ê»˜ ì¶œë ¥
          mBody.innerHTML = `
            ${ex.img ? `<img src="${ex.img}" alt="" style="width:100%; border-radius:16px; margin-bottom:12px; border:1px solid rgba(255,255,255,.08);">` : ""}
            <div style="line-height:1.65">${ex.body}</div>
          `;

          modal.classList.add("open");

          if(!seen.has(ex.id)){
            seen.add(ex.id);
            div.classList.add("seen");
            seenCountEl.textContent = String(seen.size);

            if(seen.size >= 3){
              toGauge.classList.remove("lock");
              toGauge.textContent = "ê¸°ë¶„ ê²Œì´ì§€ ê²Œì„ìœ¼ë¡œ ì´ë™ âœ";
            }
          }
        });

        museumGrid.appendChild(div);
      });
      seenCountEl.textContent = String(seen.size);
    }
    renderMuseum();

    document.getElementById("mClose").addEventListener("click", ()=> modal.classList.remove("open"));
    modal.addEventListener("click", (e)=>{ if(e.target === modal) modal.classList.remove("open"); });

    toGauge.addEventListener("click", ()=>{
      if(seen.size < 3) return;
      step3.classList.remove("hidden");
      setStep(3);
      unlocked = Math.max(unlocked, 2);
      setUnlock();
    });

    // STEP 3
    function setGauge(val, msg){
      gauge = Math.max(0, Math.min(100, val));
      barFill.style.width = gauge + "%";
      gVal.textContent = gauge + "%";
      toast.textContent = msg ?? "ì¢‹ì•„!";

      if(gauge >= 100){
        safeHint.style.display = "block";
        toSafe.classList.remove("lock");
        toSafe.textContent = "ê¸ˆê³ ë¡œ ì´ë™ âœ";
      }
    }

    document.querySelectorAll("[data-delta]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const delta = Number(btn.getAttribute("data-delta"));
        const after = gauge + delta;
        const msg = delta > 0
          ? `í–‰ë³µë„ +${delta}! (ì„¸ë¡± ê¸°ë¶„ ìƒìŠ¹ ì¤‘)`
          : `ê²½ê³  ${delta}! (ê¹…ì§€ìš´ ëˆˆì¹˜ íŒ¨ì¹˜ í•„ìš”)`;
        setGauge(after, msg);

        if(delta < 0){
          const s = document.getElementById("step3");
          s.classList.remove("shake"); void s.offsetWidth; s.classList.add("shake");
        }
      });
    });

    toSafe.addEventListener("click", ()=>{
      if(gauge < 100) return;
      step4.classList.remove("hidden");
      setStep(4);
      unlocked = 3;
      setUnlock();
    });

    // STEP 4
    function normalize(str){ return (str ?? "").trim().replace(/\s+/g,""); }

    tryCode.addEventListener("click", ()=>{
      const input = normalize(codeInput.value);
      const answer = normalize(SAFE_CODE);

      tries += 1;
      triesEl.textContent = `ì‹œë„: ${tries} / 3`;

      if(input && input === answer){
        safeStatus.innerHTML = "âœ… <b>ì ê¸ˆ í•´ì œ!</b> ì‚¬ë‘ ì¸ì¦ ì™„ë£Œ. ì—”ë”©ì„ í™•ì¸í•˜ì„¸ìš”.";
        finalBox.classList.remove("hidden");
        finalBox.scrollIntoView({behavior:"smooth", block:"start"});
        return;
      }

      if(tries >= 3){
        safeStatus.innerHTML =
          "ğŸ”” <b>ë³´ì•ˆ ëª¨ë“œ</b>: ì½”ë“œ 3íšŒ ì‹¤íŒ¨â€¦<br/>" +
          "ëŒ€ì‹  <b>ì• êµ ì¸ì¦</b>ìœ¼ë¡œ í†µê³¼ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì„¸ë¡±ì—ê²Œ â€œì‚¬ë‘í•´â€ ë§í•˜ë©´ ìë™ í†µê³¼)";
      } else {
        safeStatus.innerHTML = `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. (ê¹…ì§€ìš´ì€ ë” ì—´ì‹¬íˆ í•˜ê² ìŠµë‹ˆë‹¤)<br/>ë‚¨ì€ ê¸°íšŒ: <b>${3-tries}</b>`;
      }
    });

    giveHint.addEventListener("click", ()=>{
      safeStatus.innerHTML =
        "ğŸ’¡ íŒíŠ¸: ë§Œë‚œ ë‚ ì—ì„œ ë‚˜ì˜¨ 4ìë¦¬ì…ë‹ˆë‹¤.<br/>" +
        "<b>2025-05-06</b> â†’ (MMDD)";
      codeInput.focus();
    });

    // init
    setStep(1);
    setUnlock();
  </script>
</body>
</html>
